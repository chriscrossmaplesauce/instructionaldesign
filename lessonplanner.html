<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lesson Planner - Version 2 Fixed</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    .container {
      padding: 20px;
      text-align: center;
    }
    .title {
      font-size: 2em;
      margin-bottom: 20px;
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }
    .card {
      border-radius: 12px;
      padding: 20px;
      background-size: cover;
      background-position: center;
      color: white;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3em;
      font-weight: bold;
      cursor: pointer;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    }
    .lesson-event {
      background: rgba(255,255,255,0.9);
      margin: 15px auto;
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      max-width: 800px;
      position: relative;
    }
    .lesson-event h3 {
      margin-top: 0;
    }
    .drag-handle {
      cursor: grab;
      font-size: 18px;
      margin-right: 8px;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      margin-top: 10px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .media-options {
      margin-top: 10px;
    }
    .suggestions {
      margin-top: 10px;
      font-style: italic;
      color: #444;
    }
    .suggestions li {
      cursor: pointer;
      margin-bottom: 5px;
    }
    .button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      margin: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .button:hover {
      background: #45a049;
    }
    .lesson-planner-title {
      color: white;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="container" id="main-container">
  <h1 class="title">Lesson Planner</h1>
  <div class="card-grid">
    <div class="card" style="background-image:url('plants.jpg')" onclick="showPlanner('Plant Parts')">üå± Plant Parts</div>
    <div class="card" style="background-image:url('butterflies.jpg')" onclick="showPlanner('Butterfly Life Cycle')">ü¶ã Butterfly Life Cycle</div>
    <div class="card" style="background-image:url('fruits.jpg')" onclick="showPlanner('Healthy Foods')">üçé Healthy Foods</div>
    <div class="card" style="background-image:url('blocks.jpg')" onclick="showPlanner('DIY')">üõ†Ô∏è Do-It-Yourself</div>
  </div>
</div>

<script>
const topics = {
  "Plant Parts": {
    bg: "plants.jpg",
    objective: "Students will identify and describe the functions of major plant parts: roots, stems, leaves, flowers.",
    events: [
      {id:"roots", title:"Roots", suggestions:["Roots absorb water","Anchor the plant","Store nutrients"]},
      {id:"stems", title:"Stems", suggestions:["Transport water","Support plant","Carry nutrients"]},
      {id:"leaves", title:"Leaves", suggestions:["Photosynthesis","Exchange gases","Provide shade"]},
      {id:"flowers", title:"Flowers", suggestions:["Attract pollinators","Reproduction","Produce seeds"]}
    ]
  },
  "Butterfly Life Cycle": {
    bg: "butterflies.jpg",
    objective: "Students will explain each stage of a butterfly‚Äôs life: egg, caterpillar, chrysalis (pupa), adult butterfly.",
    events: [
      {id:"egg", title:"Egg", suggestions:["Butterfly eggs on leaves","Small and round","Hatch into larvae"]},
      {id:"caterpillar", title:"Caterpillar", suggestions:["Eats leaves","Grows quickly","Molts skin"]},
      {id:"pupa", title:"Pupa/Chrysalis", suggestions:["Transformation stage","Protective casing","Metamorphosis occurs"]},
      {id:"adult", title:"Adult Butterfly", suggestions:["Emerges with wings","Pollinates flowers","Lays eggs"]}
    ]
  },
  "Healthy Foods": {
    bg: "fruits.jpg",
    objective: "Students will categorize foods into healthy groups and explain benefits of fruits, vegetables, grains, and proteins.",
    events: [
      {id:"fruits", title:"Fruits", suggestions:["Good source of vitamins","Sweet and healthy snacks","Examples: apples, bananas"]},
      {id:"vegetables", title:"Vegetables", suggestions:["Rich in fiber","Essential nutrients","Examples: carrots, broccoli"]},
      {id:"grains", title:"Grains", suggestions:["Provide energy","Examples: rice, bread","Choose whole grains"]},
      {id:"proteins", title:"Proteins", suggestions:["Build muscles","Examples: beans, meat","Important for growth"]}
    ]
  },
  "DIY": {
    bg: "blocks.jpg",
    objective: "Teachers can create their own lesson plan by defining objectives and key content.",
    events: [
      {id:"event1", title:"Custom Event 1", suggestions:["Add your own idea","Tailor to your students","Be creative"]},
      {id:"event2", title:"Custom Event 2", suggestions:["Add another activity","Include discussions","Hands-on task"]},
      {id:"event3", title:"Custom Event 3", suggestions:["Assessment method","Reflection","Sharing results"]}
    ]
  }
};

const mediaOptions=["Slides","Images","Videos","Worksheets","Discussion","Experiment","Other"];

function showPlanner(topicName){
  const topic=topics[topicName];
  const container=document.getElementById("main-container");
  container.innerHTML=`<h2 class="lesson-planner-title">${topicName}</h2>
    <p style="color:white; font-weight:bold;">Objective: ${topic.objective}</p>
    <button class="button" onclick="location.reload()">‚¨ÖÔ∏è Return to Main Page</button>`;
  container.style.backgroundImage=`url('${topic.bg}')`;
  container.style.backgroundSize="cover";
  container.style.backgroundPosition="center";
  container.style.position="relative";

  topic.events.forEach(event=>{
    const div=document.createElement("div");
    div.className="lesson-event";
    div.dataset.title=event.title;
    div.innerHTML=`
      <h3><span class="drag-handle">‚ò∞</span> ${event.title}</h3>
      <div class="media-options"><b>Media:</b><br>
        ${mediaOptions.map((m,i)=>`<label><input type="checkbox" value="${m}">${m}</label>`).join(" ")}
        <label>Other: <input type="text" class="other-text"></label>
      </div>
      <div class="suggestions"><b>Suggestions:</b><ul>${event.suggestions.map(s=>`<li>${s}</li>`).join("")}</ul></div>
      <textarea placeholder="How will you implement this event?"></textarea>
    `;
    container.appendChild(div);

    const textarea=div.querySelector("textarea");
    const checkboxes=div.querySelectorAll('input[type=checkbox]:not(.other-text)');
    const otherText=div.querySelector(".other-text");

    // Load autosave
    textarea.value=localStorage.getItem(`lesson_${topicName}_${event.id}`)||"";
    const savedMedia=JSON.parse(localStorage.getItem(`lesson_${topicName}_media_${event.id}`))||[];
    checkboxes.forEach((cb,i)=> cb.checked=savedMedia.includes(i));
    if(savedMedia.some(m=>typeof m==="string")) otherText.value=savedMedia.find(m=>typeof m==="string");

    // Autosave
    textarea.addEventListener("input",()=>{ localStorage.setItem(`lesson_${topicName}_${event.id}`,textarea.value); });
    checkboxes.forEach((cb,i)=> cb.addEventListener("change",()=>{ saveMedia(event.id); }));
    otherText.addEventListener("input",()=>{ saveMedia(event.id); });
    function saveMedia(eventId){
      let selected=Array.from(checkboxes).map((cb,i)=> cb.checked?i:null).filter(x=>x!==null);
      if(otherText.value.trim()!=="") selected.push(otherText.value.trim());
      localStorage.setItem(`lesson_${topicName}_media_${eventId}`,JSON.stringify(selected));
    }

    // Suggestions click
    div.querySelectorAll(".suggestions li").forEach(li=>{
      li.addEventListener("click",()=>{
        textarea.value=li.textContent;
        localStorage.setItem(`lesson_${topicName}_${event.id}`,textarea.value);
      });
    });
  });

  // Make sortable
  Sortable.create(container,{handle:".drag-handle", animation:150});

  // Export PDF button
  const exportBtn=document.createElement("button");
  exportBtn.className="button";
  exportBtn.textContent="üñ®Ô∏è Export to PDF";
  exportBtn.style.position="relative";
  exportBtn.style.zIndex="2";
  exportBtn.addEventListener("click",()=>{
    const { jsPDF }=window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(16);
    doc.text(`Lesson Planner: ${topicName}`,10,10);
    const rows=Array.from(container.querySelectorAll(".lesson-event")).map(div=>{
      const title=div.dataset.title;
      const textarea=div.querySelector("textarea").value;
      const mediaInputs=div.querySelectorAll('input[type=checkbox]:not(.other-text)');
      const otherText=div.querySelector(".other-text").value;
      const mediaArr=Array.from(mediaInputs).map((cb,i)=>cb.checked?mediaOptions[i]:"").filter(x=>x!=="");
      if(otherText.trim()!=="") mediaArr.push(otherText.trim());
      return [title, mediaArr.join(", "), textarea];
    });
    doc.autoTable({startY:20, head:[["Event","Media","Prescription"]], body:rows, styles:{fontSize:10,cellPadding:3}, headStyles:{fillColor:[100,149,237],textColor:255}, theme:'grid', columnStyles:{0:{cellWidth:50},1:{cellWidth:50},2:{cellWidth:90}}});
    doc.save(`${topicName}_LessonPlanner.pdf`);
  });
  container.appendChild(exportBtn);
}
</script>
</body>
</html>
