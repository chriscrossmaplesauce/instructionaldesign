<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Scaffolded Objectives/Time-Line Matrix</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, select { margin-bottom: 10px; width: 100%; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #333; padding: 8px; text-align: center; }
  th { background-color: #f0f0f0; }
  .button { margin-top: 10px; padding: 10px; }
  select { width: 130px; }
</style>

<!-- jsPDF and autoTable (non-module version) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

</head>
<body>

<h2>Smart Scaffolded Objectives/Time-Line Matrix Generator</h2>

<label>Lesson Topic:</label>
<input type="text" id="lessonTopic" placeholder="e.g., Parts of the Cell">

<label>Enter Objectives (comma-separated):</label>
<input type="text" id="objectives">

<label>Enter Entry Skills (comma-separated):</label>
<input type="text" id="entrySkills">

<label>Number of Time Blocks:</label>
<input type="number" id="timeBlocks" value="5" min="1">

<h3>Instructional Events (Gagn√© 9 Events)</h3>
<p>1: Gain attention, 2: Inform objectives, 3: Stimulate recall, 4: Present content, 5: Provide guidance, 6: Elicit performance, 7: Provide feedback, 8: Assess performance, 9: Enhance retention/transfer</p>

<button class="button" onclick="prefillExample()">Prefill Example</button>
<button class="button" onclick="generateSmartMatrix()">Generate Smart Scaffolded Matrix</button>
<button class="button" onclick="exportMatrix()">Export as PDF</button>

<div id="matrixContainer"></div>

<script>
const events = [
    {id:1, name:"Gain attention"},
    {id:2, name:"Inform objectives"},
    {id:3, name:"Stimulate recall"},
    {id:4, name:"Present content"},
    {id:5, name:"Provide guidance"},
    {id:6, name:"Elicit performance"},
    {id:7, name:"Provide feedback"},
    {id:8, name:"Assess performance"},
    {id:9, name:"Enhance retention/transfer"},
    {id:0, name:"N/A"} // Not applicable option
];

// Smart scaffold logic based on objectives
function suggestedEvents(timeIndex, totalTimes, objectiveIndex) {
    const objectiveEvents = [
        [1,2,4],  // Identify structures
        [4,5],    // Explain functions
        [3,4],    // Compare plant vs animal
        [4,6],    // Analyze chloroplasts
        [6,7,8]   // Label diagram
    ];

    const eventsForObjective = objectiveEvents[objectiveIndex] || [];

    const earlyBlock = 0;
    const midBlock = Math.floor(totalTimes/2);
    const lateBlock = totalTimes-1;

    let selectedEvents = [];

    eventsForObjective.forEach(ev => {
        if(timeIndex === earlyBlock && [1,2,3].includes(ev)) selectedEvents.push(ev);
        else if(timeIndex === midBlock && [4,5,6].includes(ev)) selectedEvents.push(ev);
        else if(timeIndex === lateBlock && [7,8,9].includes(ev)) selectedEvents.push(ev);
    });

    return selectedEvents;
}

function generateSmartMatrix() {
    const topic = document.getElementById('lessonTopic').value || "Lesson Topic";
    const objectives = document.getElementById('objectives').value.split(',').map(o => o.trim()).filter(o => o);
    const timeBlocks = parseInt(document.getElementById('timeBlocks').value);

    if(objectives.length===0) { alert("Please enter at least one objective."); return; }

    let matrixHTML = `<h3>Smart Scaffolded Matrix for "${topic}"</h3>`;
    matrixHTML += '<table><tr><th>Objective</th>';
    for(let t=1; t<=timeBlocks; t++) matrixHTML += `<th>T${t}</th>`;
    matrixHTML += '</tr>';

    objectives.forEach((obj, objIndex) => {
        matrixHTML += `<tr><td>${obj}</td>`;
        for(let tIndex=0; tIndex<timeBlocks; tIndex++) {
            const preselect = suggestedEvents(tIndex, timeBlocks, objIndex);
            let options = `<select multiple>`;
            events.forEach(ev => {
                const selected = preselect.includes(ev.id) ? "selected" : "";
                options += `<option value="${ev.id}" ${selected}>${ev.name}</option>`;
            });
            options += `</select>`;
            matrixHTML += `<td>${options}</td>`;
        }
        matrixHTML += '</tr>';
    });

    matrixHTML += '</table>';
    document.getElementById('matrixContainer').innerHTML = matrixHTML;
}

function exportMatrix() {
    const table = document.querySelector('#matrixContainer table');
    if(!table) { alert("No matrix to export!"); return; }

    const doc = new jsPDF();

    // Headers
    const headers = [];
    table.rows[0].cells.forEach(cell => headers.push(cell.innerText));

    // Table body
    const data = [];
    for(let r=1; r<table.rows.length; r++) {
        const row = [];
        for(let c=0; c<table.rows[r].cells.length; c++) {
            const cell = table.rows[r].cells[c];
            const select = cell.querySelector('select');
            if(select) {
                const selected = Array.from(select.selectedOptions).map(o => o.text).join(", ");
                row.push(selected || "N/A");
            } else {
                row.push(cell.innerText);
            }
        }
        data.push(row);
    }

    doc.autoTable({
        head: [headers],
        body: data,
        startY: 20,
        styles: { fontSize: 10, cellWidth: 'wrap' },
        headStyles: { fillColor: [220, 220, 220] },
    });

    doc.save("Plant_Cell_Matrix.pdf");
}

// Prefill example
function prefillExample() {
    document.getElementById('lessonTopic').value = "Plant Cell Structure";
    
    document.getElementById('objectives').value = 
        "A. Identify the main structures of a plant cell," +
        "B. Explain the function of each plant cell organelle," +
        "C. Compare and contrast plant cells with animal cells," +
        "D. Analyze the role of chloroplasts in photosynthesis and energy production," +
        "E. Demonstrate the ability to correctly label a diagram of a plant cell";
    
    document.getElementById('entrySkills').value = 
        "Basic understanding of cells, Familiarity with general cell components, Ability to read and interpret diagrams, Understanding differences between living and non-living things, Basic knowledge of photosynthesis";
    
    document.getElementById('timeBlocks').value = "5";
    
    generateSmartMatrix();
}
</script>

</body>
</html>
