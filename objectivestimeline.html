<script>
function exportSmartMatrixPDF() {
    const table = document.querySelector('#matrixContainer table');
    if(!table){ alert("No matrix to export!"); return; }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add lesson topic at top
    const topic = document.getElementById('lessonTopic').value || "Lesson Topic";
    doc.setFontSize(16);
    doc.text(`Smart Scaffolded Matrix: ${topic}`, 10, 10);
    doc.setFontSize(12);
    let startY = 20;

    // Add objectives as a list
    const objectives = document.getElementById('objectives').value.split(',').map(o=>o.trim()).filter(o=>o);
    if(objectives.length > 0){
        doc.text("Objectives:", 10, startY);
        startY += 6;
        objectives.forEach(obj=>{
            doc.text("â€¢ "+obj, 12, startY);
            startY += 6;
        });
    }

    // Build table data
    const headers = [];
    for(let cell of table.rows[0].cells){
        headers.push(cell.innerText);
    }

    const body = [];
    for(let r=1; r<table.rows.length; r++){
        const row = [];
        for(let c=0; c<table.rows[r].cells.length; c++){
            const cell = table.rows[r].cells[c];
            const select = cell.querySelector('select');
            if(select){
                const selected = Array.from(select.selectedOptions).map(o=>o.text).join(", ");
                row.push(selected || "N/A");
            } else {
                row.push(cell.innerText);
            }
        }
        body.push(row);
    }

    doc.autoTable({
        startY: startY + 6,
        head: [headers],
        body: body,
        styles: { fontSize: 10, cellWidth: 'wrap' },
        headStyles: { fillColor: [200, 200, 200] },
        theme: 'grid'
    });

    doc.save(`${topic}_SmartMatrix.pdf`);
}
</script>
